<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 增强微信兼容性 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="x5-page-mode" content="app">
    <meta name="x5-orientation" content="portrait">
    <meta name="x5-fullscreen" content="true">
    <meta name="full-screen" content="yes">
    <title>第⑦次测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            background: #000;
            width: 100vw;
            height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right)
                     env(safe-area-inset-bottom) env(safe-area-inset-left);
            position: relative;
            overflow: hidden;
            /* 新增iOS背景修复 */
            -webkit-overflow-scrolling: touch;
        }

        .nav-buttons {
            position: absolute;
            top: max(15px, env(safe-area-inset-top));
            right: max(15px, env(safe-area-inset-right));
            z-index: 1000;
            display: flex;
            gap: 12px;
            flex-direction: column;
        }

        .wechat-btn {
            padding: 10px 20px;
            background: rgba(0, 255, 157, 0.15);
            border: 1px solid #00ff9d;
            border-radius: 25px;
            color: #00ff9d;
            text-decoration: none;
            font-size: 14px;
            text-align: center;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
            /* 新增点击反馈 */
            -webkit-transform: translateZ(0);
        }

        .wechat-btn:active {
            background: rgba(0, 255, 157, 0.3);
            transform: scale(0.95);
        }

        /* 新增媒体容器样式 */
        #media-container {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <div class="nav-buttons">
        <a href="javascript:;" class="wechat-btn" id="playBtn">启动播放</a>
        <a href="javascript:;" class="wechat-btn">功能按钮</a>
    </div>
    
    <!-- 新增媒体容器 -->
    <video id="media-container" webkit-playsinline playsinline></video>

    <script>
        // 微信JS-SDK初始化
        document.addEventListener('WeixinJSBridgeReady', function() {
            WeixinJSBridge.invoke('getNetworkType', {}, function(res) {
                console.log('微信网络类型:', res.networkType);
            });
        });

        // 播放控制逻辑
        const playBtn = document.getElementById('playBtn');
        const mediaContainer = document.getElementById('media-container');
        
        // 添加用户交互触发
        let isFirstPlay = true;
        playBtn.addEventListener('click', async () => {
            if (isFirstPlay) {
                try {
                    await mediaContainer.play();
                    // iOS自动播放破解
                    mediaContainer.muted = false;
                    mediaContainer.autoplay = true;
                } catch (e) {
                    alert('首次播放需要点击确认 → ' + e.message);
                }
                isFirstPlay = false;
            }
        });

        // 自动播放兼容处理
        mediaContainer.muted = true;
        mediaContainer.autoplay = true;
        mediaContainer.loop = true;
        
        // 检测iOS WebKit
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIOS) {
            mediaContainer.setAttribute('playsinline', 'true');
            mediaContainer.setAttribute('preload', 'auto');
        }

        // 动态加载媒体源（示例）
        // mediaContainer.src = 'your-media-source.mp4';
    </script>
</body>
</html>
